(()=>{"use strict";const e=e=>{const t=e;let r=0;const a=()=>t;return{length:a,hit:()=>{r+=1},getHits:()=>r,isSunk:()=>r===a()}},t=t=>{const r=(t,r,a)=>{const o={};for(let c=0;c<r;c++)o[`${a+(c+1)}`]=e(t);return o},a=(()=>{const e=4,t=2,a=3,o=3,c=3,s=4,n=2,l=5;return{...r(5,1,"c"),...r(e,t,"b"),...r(a,o,"d"),...r(c,s,"s"),...r(n,l,"pb")}})(),o=(()=>{const e=(e,t)=>{const r=["empty","ship","miss","hit"];let a="empty",o=null;return{coordinates:[e,t],setShipID:e=>{a="ship",o=e},getShipID:()=>o,updateStatus:()=>{a=a===r[0]?r[2]:r[3]},getStatus:()=>a}};return{adjacencyList:(e,t)=>{const r={};return Object.keys(e).forEach((a=>{r[a]={},r[a].adjacents={},r[a].square=e[a],t.forEach((t=>{const o=`${Number(a[0])+Number(t[0])},${Number(a[2])+Number(t[1])}`;e[o]&&(r[a].adjacents[o]=e[o])}))})),r},defineVertices:()=>{const t={};for(let r=0;r<10;r++)for(let a=0;a<10;a++)t[`${r},${a}`]=e(r,a);return t},moves:[[1,0],[0,1],[-1,0],[0,-1]]}})(),c=o.adjacencyList(o.defineVertices(),o.moves);var s,n;t&&(s=a,n=c,Object.keys(s).forEach((e=>{const t=s[e].length(),r=[[1,0],[0,1],[-1,0],[0,-1]];let a=!1;for(;!a;){const o=Object.keys(n)[Math.floor(Math.random()*Object.keys(n).length)];r.forEach((r=>{if(!a){let c=0;for(let e=0;e<t;e++){const a=r[0]*(t-e),s=r[1]*(t-e),l=`${Number(o[0])+a},${Number(o[2])+s}`;if(!n[l])break;if(n[l].square.getShipID())break;c+=1}if(c===t){for(let a=0;a<t;a++){const c=r[0]*(t-a),s=r[1]*(t-a),l=`${Number(o[0])+c},${Number(o[2])+s}`;n[l].square.setShipID(e)}a=!0}}}))}})));const l=e=>{const t=c[e].square.getStatus();if("ship"===t){c[e].square.updateStatus();const t=c[e].square.getShipID();return a[t].hit(),!0}return"empty"===t&&(c[e].square.updateStatus(),!1)};return{placeShipManually:(e,t,r,a)=>{const o=e[t].length(),c=[[1,0],[0,1],[-1,0],[0,-1]];return{getValidDirections:()=>{const e=[];return c.forEach((t=>{let c=0;for(let e=1;e<o+1;e++){const s=t[0]*(o-e),n=t[1]*(o-e),l=`${Number(a[0])+s},${Number(a[2])+n}`;if(!r[l])break;if(r[l].square.getShipID())break;c+=1}c===o&&e.push(t)})),e},placeShip:e=>{for(let c=1;c<o+1;c++){const s=e[0]*(o-c),n=e[1]*(o-c),l=`${Number(a[0])+s},${Number(a[2])+n}`;r[l].square.setShipID(t)}}}},board:c,ships:a,receiveAttack:l,allShipsSunk:()=>{let e=0;return Object.keys(a).forEach((t=>{a[t].isSunk()&&(e+=1)})),15===e},hitAll:()=>{Object.keys(c).forEach((e=>{l(e)}))}}},r=e=>{const t=e;let r=0;const a={},o={};for(let e=0;e<10;e+=1)for(let t=0;t<10;t+=1)o[`${e},${t}`]=!0;return{getPlayer:()=>t,validMove:e=>!!o[e]&&!a[e]&&(a[e]=!0,e),computerMakeMove:()=>{const e=Object.keys(o);let t,r=!1;for(;!r;)t=e[Math.floor(Math.random()*e.length)],a[t]||(a[t]=!0,r=!0);return t},getScore:()=>r,updateScore:()=>{r+=1}}},a=t(),o=t(!0),c=r("Player 1"),s=r("Computer"),n=(()=>{const e=(t,r,a,o)=>{t.textContent="",Object.keys(r).forEach((c=>{const s=document.createElement("div");s.classList.add("square"),s.id=a?`p1-${c}`:`p2-${c}`,s.classList.add(c),o&&s.addEventListener("click",(()=>{console.log(o(c))})),"auto"===a&&s.addEventListener("click",(()=>{o(c)&&e(t,r,a,o)})),a&&(r[c].square.getShipID()?(s.classList.add("has-ship"),s.classList.add(`${r[c].square.getShipID()}`)):s.classList.add("no-ship")),t.appendChild(s)}))},t=document.querySelector(".player-1.score>.score.num"),r=document.querySelector(".player-2.score>.score.num"),a=document.querySelector(".boards>.player-1"),o=document.querySelector(".ship.placement>.player-1"),c=document.querySelector(".boards>.player-2");return{getDirection:(e,t,r,a)=>{document.querySelector(".ship.direction").classList.remove("hid"),e.forEach((o=>{document.querySelector(`#${o}`).addEventListener("click",(function(){return document.querySelector(".ship.direction").classList.add("hid"),e.forEach((e=>{const t=document.querySelector(`#${e}`);t.replaceWith(t.cloneNode(!0))})),r(t[o]),a(),o}))}))},hideBoardPlacement:()=>{const e=document.querySelector(".ship.placement");e.textContent="",e.classList.add("hid")},makeBoard:e,player1Board:a,player1BoardPlacement:o,player2Board:c,updateP1Score:e=>{t.textContent=e},updateP2Score:e=>{r.textContent=e},updateBoardCom:(e,t)=>{document.getElementById(`p2-${e}`).classList.add(t)},updateBoardPlayer:(e,t)=>{document.getElementById(`p1-${e}`).classList.add(t)},displayVictory:e=>{const t=document.querySelector(".victory.screen");document.querySelector(".victory.screen .text").textContent=`${e} wins!`,t.classList.toggle("hid")}}})(),l=Object.keys(a.ships),d=e=>{if(console.log("Placement got called. Cell:"),console.log("Shipkeys",l.length),l.length<=0)return n.hideBoardPlacement(),n.makeBoard(n.player1Board,a.board,"manual"),!1;const t=l.pop(),r=a.placeShipManually(a.ships,t,a.board,e),o=r.getValidDirections();o||l.push(t);const c={},s=o.map((e=>1===e[0]?(c.down=e,"down"):-1===e[0]?(c.up=e,"up"):1===e[1]?(c.right=e,"right"):-1===e[1]&&(c.left=e,"left")));if(s.length>0){const e=()=>{n.makeBoard(n.player1BoardPlacement,a.board,"placement",d)};n.getDirection(s,c,r.placeShip,e)}else l.push(t);return!0};n.makeBoard(n.player1Board,a.board,"manual"),n.makeBoard(n.player1BoardPlacement,a.board,"placement",d),n.makeBoard(n.player2Board,o.board,!1,(e=>{const t=c.validMove(e);if(t){const e=s.computerMakeMove();o.receiveAttack(t)&&c.updateScore(),o.allShipsSunk()&&n.displayVictory(c.getPlayer()),a.receiveAttack(e)&&s.updateScore(),a.allShipsSunk()&&!o.allShipsSunk()&&n.displayVictory(s.getPlayer()),n.updateP1Score(c.getScore()),n.updateP2Score(s.getScore());const r=a.board[e].square.getStatus(),l=o.board[t].square.getStatus();n.updateBoardPlayer(e,r),n.updateBoardCom(t,l)}}))})();